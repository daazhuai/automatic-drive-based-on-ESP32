## ä½œä¸šè¦æ±‚

2021çº§ï¼ˆå°ç»„å®Œæˆï¼Œæ¯ç»„ä¸èƒ½è¶…è¿‡4äººï¼‰ï¼š
1.ç ”è¯»å°è½¦æ§åˆ¶æ¿PCBåŸç†å›¾ï¼Œç”¨Arduino C++å®Œæˆé©±åŠ¨å¼€å‘ï¼Œèƒ½å®ç°æ‘„åƒå¤´è§†é¢‘åŠç…§ç‰‡è¯»å–ï¼ˆéœ€è°ƒæ•´ç›¸æœºå‚æ•°ï¼‰ã€Wifiçƒ­ç‚¹å¼€å¯ã€å°è½¦æ‹å¼¯ã€ç›´çº¿è¡Œèµ°ã€å€’è½¦ç­‰åŠ¨ä½œï¼Œæ¯ä¸ªåŠ¨ä½œå°è£…ä¸ºä¸€ä¸ªå‡½æ•°ï¼ˆ30%ï¼‰
2.ç”µè„‘ç”¨Pythonä¸å°è½¦æ§åˆ¶æ¿è¿æ¥ï¼Œç”µè„‘åšä¸Šä½æœºï¼Œç”¨å‚æ•°å’Œé”®ç›˜å®ç°æ§åˆ¶å°è½¦åœ¨åœ°å›¾ä¸Šè¡Œèµ°ï¼Œå¹¶å¯¹åœ°å›¾æ‹ç…§ï¼Œå­˜å‚¨åœ¨SDå¡ä¸Šï¼ˆ30%ï¼‰
3.ä½¿ç”¨ç™¾åº¦EasyDLï¼Œå¯¹åœ°å›¾ç…§ç‰‡è¿›è¡Œé“è·¯æ ‡æ³¨ï¼Œè®­ç»ƒä¸€ä¸ªEasyDLé“è·¯åˆ†å‰²æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œç”Ÿæˆä¸€ä¸ªäº‘APIï¼Œç»“åˆæœ¬åœ°ç”µè„‘ã€å°è½¦æ§åˆ¶æ¿ã€å°è½¦æ‘„åƒå¤´ï¼Œå®ç°å°è½¦åœ¨åœ°å›¾é“è·¯ä¸­è‡ªåŠ¨è¡Œèµ°ï¼ˆ30%ï¼‰
4.ç”¨Arduinoåœ¨å°è½¦æ§åˆ¶æ¿ä¸Šå®ç°WebæœåŠ¡ï¼Œåšä¸€ä¸ªç½‘é¡µï¼Œç”¨æ‰‹æœºæµè§ˆå™¨å¯ä»¥æ“æ§å°è½¦ï¼ˆ10%ï¼‰

æˆªæ­¢æ—¥æœŸï¼š8æœˆ28æ—¥æ™šï¼Œè¯´æ˜æ–‡æ¡£éœ€éå¸¸è¯¦ç»†ï¼Œæ–‡æ¡£ä»£ç åŠç›¸å…³èµ„æ–™ä¸Šä¼ ä¸ªäººGithubï¼ŒBç«™è§†é¢‘å‘QQå®éªŒç­å…¬å‘Šç¾¤ã€‚



## å¼€å‘ç¯å¢ƒæ­å»º

### Arduino(C)

1 Arduinoä¸‹è½½å®‰è£…

2 ä¸²å£é©±åŠ¨

**USBè½¬ä¸²å£**å®ç°è®¡ç®—æœºUSBæ¥å£åˆ°ç‰©ç†ä¸²å£ä¹‹é—´çš„è½¬æ¢ï¼šä¸ºæ²¡æœ‰ä¸²å£çš„è®¡ç®—æœºå¢åŠ ä¸²å£ï¼Œç­‰äºå°†ä¼ ç»Ÿçš„ä¸²å£è®¾å¤‡å˜æˆäº†USBè®¾å¤‡

> å®ç°USBè½¬ä¸²å£ï¼š
>
> â‘  å¼€å‘æ¿ï¼šUSBè½¬ä¸²å£èŠ¯ç‰‡
>
> â‘¡ ç”µè„‘ï¼šUSBè½¬ä¸²å£é©±åŠ¨
>
> æ³¨ï¼šæœ‰äº›USBè½¬ä¸²å£èŠ¯ç‰‡æ˜¯å…é©±åŠ¨çš„ï¼›Win10ç³»ç»Ÿè‡ªå¸¦éƒ¨åˆ†é©±åŠ¨

è½¯ä»¶ä¸­ï¼š

â‘  ä¸²å£  é€‰æ‹©è¿æ¥ä¸²å£ï¼šæ£€æµ‹ç«¯å£ï¼ˆæ­¤ç”µè„‘ï¼ˆå³é”®ï¼‰â†’ ç®¡ç† â†’ ç¡¬ä»¶ç®¡ç†å™¨ â†’ ç«¯å£ï¼‰

â‘¡ æ³¢ç‰¹ç‡  ä¸²å£ç›‘è§†å™¨æ³¢ç‰¹ç‡è®¾ç½®ä¸º115200

ï¼ˆç¨‹åºä¸­é€šè¿‡Serial.beginå¯åŠ¨ä¸²å£é€šä¿¡åå¯ä»¥åœ¨ä¸²å£ç›‘è§†å™¨ä¸­çœ‹åˆ°å¯¹åº”ä¿¡æ¯ï¼‰

3 Arduino ç¯å¢ƒä¸»é¡µé¢ï¼ˆå¼€å‘æ¿&åº“æ–‡ä»¶ï¼‰

ï¼ˆ1ï¼‰å¼€å‘æ¿é…ç½®

æ–‡ä»¶ --- é¦–é€‰é¡¹

<img src="C:\Users\liufangfei\AppData\Roaming\Typora\typora-user-images\image-20220813085803518.png" alt="image-20220813085803518" style="zoom:80%;" />

ç‚¹å¼€åœ°å€ï¼Œå°†AppData-Local-Arduino15ä¸­çš„æ–‡ä»¶å…¨éƒ¨å¤åˆ¶åˆ°è¯¥åœ°å€ç›®å½•ä¸­

ï¼ˆ2ï¼‰å…å®‰è£…å¼€å‘æ¿ç¯å¢ƒ/åº“æ–‡ä»¶é…ç½®ï¼š

åº“æ–‡ä»¶ä½ç½®ï¼šCç›˜ â†’ Program Files(x86) â†’ Arduino â†’ librariesï¼ˆæ‰€æœ‰å¤´æ–‡ä»¶æ‰€éœ€åº“åº”è¯¥æ”¾åˆ°librarieså†…ï¼‰

----------------

å…å®‰è£…ç¯å¢ƒï¼š

å°†ä¸‹è½½å¥½çš„Arduinoã€APPDataä¸¤ä¸ªæ–‡ä»¶æ”¾åˆ°æœ¬æœºCç›˜å¯¹åº”çš„æ–‡ä»¶å¤¹ä¸­ï¼Œæ³¨æ„éœ€è¦æ˜¾ç¤ºéšè—æ–‡ä»¶

> æ–‡ä»¶ç›®å½•ï¼š
>
> å°†Arduinoæ–‡ä»¶æ”¾ç½®åœ¨`C:\Program Files (x86)`ä¸­
>
> å°†APPDataä¸­çš„Arduino15æ–‡ä»¶æ”¾ç½®åœ¨`C:\Users\liufangfei\AppData\Local`ä¸­
>
> >å¼•èˆªè®¡åˆ’æä¾›çš„èµ„æ–™ï¼š
> >
> >ä¸‹è½½åœ°å€ï¼šhttps://aistudio.baidu.com/aistudio/datasetdetail/162528
> >
> >è§†é¢‘æ•™ç¨‹ï¼ˆå‰3min30sï¼‰ï¼š
> >
> >https://www.bilibili.com/video/BV1hN4y1T7H8?spm_id_from=333.999.0.0&vd_source=4172983847c80a53fb2e62caed743dc8

å¼€å‘ç¯å¢ƒä¸­ï¼š

â‘  å¼€å‘æ¿ï¼šå·¥å…· â†’ å¼€å‘æ¿ â†’ é€‰æ‹©å¼€å‘æ¿ AI Thinker ESP32 CAM

â‘¡ ä¸²å£ï¼šå·¥å…· â†’ ä¸²å£ â†’ é€‰æ‹©ä¸²å£ï¼Œä½¿ç”¨ä¸²å£ç›‘è§†å™¨ï¼ˆå³ä¸Šæ–¹ğŸ”ï¼‰è°ƒè¯•

> **é—®é¢˜ï¼š**
>
> 1.ä¸²å£å ç”¨ï¼š
>
> æ³¨å†Œè¡¨ç¼–è¾‘å™¨ä¸­æŸ¥çœ‹å ç”¨ä¸²å£çš„è½¯ä»¶ï¼Œè§£é™¤ç¨‹åºå ç”¨
>
> 2.ç¯å¢ƒå˜é‡ï¼š
>
> æŠ¥é”™ï¼šexecï¼š"cmd.exe"ï¼šexecutable file not found in %path%
>
> è§£å†³æ–¹å¼ï¼šæ­¤ç”µè„‘ â†’ å³é”® â†’ å±æ€§ â†’ æœç´¢ç¯å¢ƒå˜é‡ï¼šåœ¨ç³»ç»Ÿç¯å¢ƒå˜é‡ä¸­æ·»åŠ cmd.exeæ‰€åœ¨è·¯å¾„
>
> > https://zhidao.baidu.com/question/1903702886412298020.html

### Thonny(Python)

1.éœ€ä¸‹è½½çš„è½¯ä»¶

â‘  Thonny https://thonny.org/

â‘¡ python3 ï¼ˆå®‰è£…pycharmæ—¶å·²å®‰è£…ï¼‰

â‘¢ esp32-micropythonå›ºä»¶ https://micropython.org/download/esp32/

â‘£ å¼€å‘æ¿å¯¹åº”çš„ä¸²å£é©±åŠ¨ï¼ˆWin10è‡ªå¸¦ï¼‰

2.å®‰è£…esptool

å·¥å…· â†’ ç®¡ç†æ’ä»¶ â†’ æœç´¢esptoolå¹¶å®‰è£…ï¼Œæˆ–è¿è¡Œcmdè„šæœ¬ï¼ˆåœ¨å·²æœ‰python3&pipçš„æ¡ä»¶ä¸‹ï¼‰ï¼š

```cmd
pip install esptool
```

3.å›ºä»¶æ“¦é™¤å¹¶æ›´æ–°

â‘  å·¥å…· â†’ è®¾ç½® â†’ è§£é‡Šå™¨ â†’ é€‰æ‹©Micropython(ESP32)

â‘¡ åœ¨Port or WebREPL ä¸­é€‰æ‹©å¯¹åº”çš„ç«¯å£å·ã€‚

â‘¢ ç‚¹å‡» install or update firmareï¼š

â€‹     Porté€‰æ‹©ç«¯å£å·ï¼ŒFiremare é€‰æ‹© æ­¥éª¤ä¸€ä¸­3 æ‰€ä¸‹è½½çš„micropythonå›ºä»¶åŒ…ï¼Œé€‰ä¸­ Erase flash before installing ç„¶åç‚¹å‡»å®‰è£…

> ä¸²å£å ç”¨é—®é¢˜ï¼š
>
> > å›ºä»¶æ“¦é™¤æ­¥éª¤å³ä¸ºäº†æ¸…æ¥šå›ºä»¶ä¸­åŸæœ‰çš„pyç¨‹åºï¼Œè§£å†³ä¸²å£å ç”¨é—®é¢˜
>
> å¼€å§‹èœå•ä¸‹æœç´¢å¹¶æ‰“å¼€æ³¨å†Œè¡¨ç¼–è¾‘å™¨ï¼ˆregeditï¼‰ï¼ŒæŸ¥çœ‹è·¯å¾„å¦‚ä¸‹
>
> ```
> è®¡ç®—æœº\HKEY_LOCAL_MACHINE\HARDWARE\DEVICEMAP\SERIALCOMM
> ```
>
> åœ¨å³ä¾§ComDbå³é”®é€‰æ‹©åˆ é™¤ï¼šè®©ç³»ç»Ÿé‡æ–°æ„å»ºCOMç«¯å£çš„åˆ—è¡¨ï¼Œæ›´æ”¹é‚£äº›ç«¯å£è¢«å ç”¨çš„çŠ¶æ€
>
> > https://xinzhi.wenda.so.com/m/a/1523288061202474?ivk_sa=1024320u



## ArduinoåŸºç¡€è¯­æ³•

> [ã€Arduinoã€‘åŸºæœ¬è¯­æ³•æ¢³ç†_é™Œæ¹˜è˜çš„åšå®¢-CSDNåšå®¢](https://blog.csdn.net/sinat_28782331/article/details/85866157)

define

> \#define åœ¨ç¼–è¯‘ä¹‹å‰ç»™å¸¸é‡å‘½å
>
> åœ¨Arduinoä¸­ï¼Œå®šä¹‰çš„å¸¸é‡ä¸ä¼šå ç”¨èŠ¯ç‰‡ä¸Šçš„ä»»ä½•ç¨‹åºå†…å­˜ç©ºé—´ï¼Œç¼–è¯‘æ—¶ç¼–è¯‘å™¨ä¼šç”¨äº‹å…ˆå®šä¹‰çš„å€¼æ¥å–ä»£è¿™äº›å¸¸é‡ã€‚
>
> ç„¶è€Œè¿™æ ·åšä¼šäº§ç”Ÿä¸€äº›å‰¯ä½œç”¨ï¼Œä¾‹å¦‚ï¼Œä¸€ä¸ªå·²è¢«å®šä¹‰çš„å¸¸é‡åå·²ç»åŒ…å«åœ¨äº†å…¶ä»–å¸¸é‡åæˆ–è€…å˜é‡åä¸­ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ–‡æœ¬å°†è¢«ï¼ƒdefined å®šä¹‰çš„æ•°å­—æˆ–æ–‡æœ¬æ‰€å–ä»£ã€‚

const

```c
//const type name
//const å’Œ type éƒ½æ˜¯ç”¨æ¥ä¿®é¥°å˜é‡çš„ï¼Œå®ƒä»¬çš„ä½ç½®å¯ä»¥äº’æ¢
//ç”±äºå¸¸é‡ä¸€æ—¦è¢«åˆ›å»ºåå…¶å€¼å°±ä¸èƒ½å†æ”¹å˜ï¼Œæ‰€ä»¥å¸¸é‡å¿…é¡»åœ¨å®šä¹‰çš„åŒæ—¶èµ‹å€¼ï¼ˆåˆå§‹åŒ–ï¼‰ï¼Œåé¢çš„ä»»ä½•èµ‹å€¼è¡Œä¸ºéƒ½å°†å¼•å‘é”™è¯¯ã€‚

const int Led = 32
```

> define&constå®šä¹‰å¸¸é‡çš„åŒºåˆ«ï¼š[constä¸#defineçš„åŒºåˆ«ã€ä¼˜ç‚¹ - è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘ (tencent.com)](https://cloud.tencent.com/developer/article/1496003#:~:text=constå®šä¹‰å¸¸é‡ä»æ±‡ç¼–çš„è§’åº¦æ¥çœ‹ï¼Œåªæ˜¯ç»™å‡ºäº†å¯¹åº”çš„å†…å­˜åœ°å€ï¼Œè€Œä¸æ˜¯è±¡%23defineä¸€æ ·ç»™å‡ºçš„æ˜¯ç«‹å³æ•°ï¼Œæ‰€ä»¥ï¼Œconstå®šä¹‰çš„å¸¸é‡åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­åªæœ‰ä¸€ä»½æ‹·è´ï¼Œè€Œ,%23defineå®šä¹‰çš„å¸¸é‡åœ¨å†…å­˜ä¸­æœ‰è‹¥å¹²ä¸ªæ‹·è´ã€‚ constå¸¸é‡å¯ä»¥è¿›è¡Œè°ƒè¯•çš„ã€‚)

```
// æ•°å­—ä¿¡å·å¼•è„šå‡½æ•°
pinMode();
digitalRead();
digitalWrite();
```

```c
// ä»»åŠ¡1ï¼šç®€æ˜“å°ç¯
// æŒ‰é’®æ§åˆ¶ç¯æ³¡äº®ç­ï¼ˆé•¿æŒ‰é•¿äº®ï¼Œä¸æŒ‰åˆ™ç­ï¼‰
const int an34 = 34;
const int LED32 = 32;
void setup() {
  Serial.begin(115200);
  pinMode(an34,INPUT);
  pinMode(LED32,OUTPUT);
}

void loop() {
  Serial.println(digitalRead(an34));
  int con = digitalRead(an34);
  digitalWrite(LED32,con);
}

// ä»»åŠ¡2ï¼šå•ä¸ªæŒ‰é’®å®Œæ•´å°ç¯
// ï¼ˆä¸€æŒ‰ä¸€äº®/ä¸€æŒ‰ä¸€ç­ï¼‰
const int LED32 = 32;
const int an34 = 34;
boolean sig = true;
void setup() {
  pinMode(LED32,OUTPUT);
  pinMode(an34,INPUT);
}

void loop() {
  while(digitalRead(an34)==HIGH){};
  delay(300);
  if(sig == true){
    digitalWrite(LED32,HIGH);
    sig = !sig;
    }
  else{
    digitalWrite(LED32,LOW);
    sig = !sig;
    }
}

// ä»»åŠ¡3ï¼šåŒæŒ‰é’®å®Œæ•´å°ç¯
// ä¸¤ä¸ªæŒ‰é’®åˆ†åˆ«æ§åˆ¶ç¯æ³¡äº®ç­ï¼ˆä¸€æŒ‰ä¸€äº®/ä¸€æŒ‰ä¸€ç­ï¼‰
const int LED32 = 32;
const int LED33 = 33;
const int an34 = 34;
const int an35 = 35;
boolean sig1 = true;
boolean sig2 = true;

void setup() {
  pinMode(LED32,OUTPUT);
  pinMode(an34,INPUT);
  pinMode(LED33,OUTPUT);
  pinMode(an35,INPUT);
}

void loop() {
  while(digitalRead(an34)==HIGH && digitalRead(an35)==HIGH){};
  if(digitalRead(an34)==LOW && sig1==true){
    delay(300);
    digitalWrite(LED32,HIGH);
    sig1 = !sig1;
    }
  if(digitalRead(an34)==LOW && sig1==false){
    delay(300);
    digitalWrite(LED32,LOW);
    sig1 = !sig1;
    }
  if(digitalRead(an35)==LOW && sig2==true){
    delay(300);
    digitalWrite(LED33,HIGH);
    sig2 = !sig2;
    }
  if(digitalRead(an35)==LOW && sig2==false){
    delay(300);
    digitalWrite(LED33,LOW);
    sig2 = !sig2;
    }
}
```

## ç¡¬ä»¶è°ƒè¯•

### PWMä¿¡å·

æ„æˆPWMä¿¡å·çš„ç»„ä»¶ï¼š

â‘  é¢‘ç‡ï¼šæ¯ç§’é’Ÿç”µå¹³å˜åŒ–çš„æ¬¡æ•°ï¼Œå†³å®šæ¯ç§’å‘¨æœŸæ•°ï¼ˆé«˜-ä½-é«˜ä¸ºä¸€ä¸ªå‘¨æœŸï¼‰ï¼Œé¢‘ç‡è¶Šé«˜ç”µæµè¶Šå¹³æ»‘

â‘¡ åˆ†è¾¨ç‡ï¼šå†³å®šç²¾åº¦ï¼ˆå ç©ºæ¯”å–å€¼èŒƒå›´ï¼‰

â‘¢ å ç©ºæ¯”ï¼šä¸€ä¸ªè„‰å†²å‘¨æœŸå†…é«˜ç”µå¹³çš„æ‰€æ•´ä¸ªå‘¨æœŸå çš„æ¯”ä¾‹

æ¯ç§PWMä¿¡å·é€šè¿‡ä¸€ä¸ªä¿¡å·é€šé“ä¼ é€’



åœ¨ESP32ä¸Šæœ‰ä¸€ä¸ªLEDCå¤–è®¾æ¨¡å—ä¸“ç”¨äºè¾“å‡ºPWMï¼ˆè„‰å†²å®½åº¦è°ƒåˆ¶ï¼‰æ³¢å½¢

LEDCå¤–è®¾æ¨¡å—å¯ä»¥ç”¨äºè¾“å‡ºå¯ä»¥ç”Ÿæˆ16è·¯ç‹¬ç«‹çš„æ•°å­—æ³¢å½¢ï¼Œæ³¢å½¢çš„å‘¨æœŸå’Œå ç©ºæ¯”åˆ†è¾¨ç‡å¯ä»¥é…ç½®

> PWMï¼ˆè„‰å†²å®½åº¦è°ƒåˆ¶ï¼‰â†’ ä¸åŒé€šé“è®¾ç½®ä¸åŒé¢‘ç‡/åˆ†è¾¨ç‡ â†’ è¾“å‡ºä¿¡å·åˆ°å¤–æ¥LEDã€ç”µæœºã€èˆµæœºç­‰

```c
//ledcSetup()å‡½æ•°
//åŠŸèƒ½ä¸ºè®¾ç½®LEDCé€šé“å¯¹åº”çš„é¢‘ç‡å’Œè®¡æ•°ä½æ•°ï¼ˆå ç©ºæ¯”åˆ†è¾¨ç‡ï¼‰

//å…¶ç¬¬ä¸€ä¸ªå‚æ•°chanè¡¨ç¤ºé€šé“å·ï¼Œå–å€¼ä¸º0~15,å³å¯è®¾ç½®16ä¸ªé€šé“,å…¶ä¸­é«˜é€Ÿé€šé“(0~7)ç”±80MHzæ—¶é’Ÿé©±åŠ¨,ä½é€Ÿé€šé“(8~15)ç”±1MHzæ—¶é’Ÿé©±åŠ¨ï¼›
//ç¬¬äºŒä¸ªå‚æ•°freqä¸ºæœŸæœ›è®¾ç½®çš„é¢‘ç‡ï¼›
//ç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºå ç©ºæ¯”åˆ†è¾¨ç‡çš„è®¡æ•°ä½æ•°ï¼Œå…¶å–å€¼ä¸º0~20
//ï¼ˆè¯¥å€¼å†³å®šåé¢ ledcWrite æ–¹æ³•ä¸­å ç©ºæ¯”å¯å†™å€¼ï¼Œæ¯”å¦‚è¯¥å€¼å†™10ï¼Œåˆ™å ç©ºæ¯”æœ€å¤§å¯å†™1023 å³(1<<bit_num)-1
double ledcSetup(uint8_t chan, double freq, uint8_t bit_num)

//ledcAttachPin()
//åŠŸèƒ½ä¸ºå°†æŒ‡å®šçš„LEDCé€šé“ç»‘å®šåˆ°æŒ‡å®šçš„IOå£ä¸Šä»¥å®ç°PWMçš„è¾“å‡º

//å…¶ç¬¬ä¸€ä¸ªå‚æ•°pinè¡¨ç¤ºæˆ‘ä»¬éœ€è¦è¾“å‡ºçš„IOå£ï¼Œç¬¬äºŒä¸ªå‚æ•°channelä¸ºæˆ‘ä»¬æŒ‡å®šçš„LEDCé€šé“
void ledcAttachPin(uint8_t pin, uint8_t channel);

//ledcWrite()å‡½æ•°åŠŸèƒ½ä¸ºæŒ‡å®šçš„LEDCé€šé“çš„è¾“å‡ºå ç©ºæ¯”

//ç¬¬ä¸€ä¸ªå‚æ•°chanä¸ºæŒ‡å®šçš„LEDCé€šé“ï¼Œç¬¬äºŒä¸ªå‚æ•°dutyè¡¨ç¤ºå ç©ºæ¯”ï¼Œå…¶å–å€¼èŒƒå›´ä¸ledcSetup()å‡½æ•°çš„bit_numæœ‰å…³
void ledcWrite(uint8_t chan, uint32_t duty)
```

```C
const int led32 = 32;
const int freq = 1000;
const int r = 8;
const int rate = 0;
const int road1 = 0;

void setup() {
  // å°†é¢‘ç‡å’Œåˆ†è¾¨ç‡é…ç½®åˆ°é€šé“0
  ledcSetup(road1,freq,r);
  // å°†å¼•è„šç»‘å®šåˆ°é€šé“0
  ledcAttachPin(led32,road1);

}

void loop() {
  ledcWrite(road1,rate);
  int t = rate;
  for(int i=0; i <= 255; i++){
    t++;
    ledcWrite(road1,t);
    delay(50);
    }
  for(int i=0; i <= 255; i++){
    t--;
    ledcWrite(road1,t);
    delay(50);
    }
}
```

mcpwmï¼šä»£æ›¿ledcä½œç”µæœºçš„pwmé©±åŠ¨

ESP32æœ‰ä¸¤ä¸ªmcpwmå•å…ƒï¼Œæ¯ä¸€ä¸ªmcpwmå•å…ƒæœ‰ä¸‰ä¸ªå®šæ—¶å™¨ï¼Œæ¯ä¸ªå®šæ—¶å™¨æœ‰ä¸¤ä¸ªå¼•è„š

> https://blog.csdn.net/qqliuzhitong/article/details/121510050

```C
// åˆå§‹åŒ–ï¼šå°†26è„šç»‘å®šåˆ°0å·å•å…ƒ0å·å®šæ—¶å™¨Aè„š
mcpwm_gpio_init(MCPWM_UNIT_0,MCPWM0A,26);
mcpwm_gpio_init(MCPWM_UNIT_0,MCPWM0B,27)
mcpwm_config_t motor_pwm_config = {
    // é¢‘ç‡
    .frequency = 1000,
    // Aã€Bè„šå ç©ºæ¯”
    .cmpr_a = 0,
    .cmpr_b = 0,
    // è®¾ç½®å ç©ºæ¯”ç±»å‹ä¸ºé«˜ç”µå¹³å æ¯”
    .duty_mode = MCPWM_DUTY_MODE_0,
    .counter_mode = MCPWM_UP_COUNTER,
  };
// è°ƒç”¨mcpwm_initä½¿é…ç½®ç”Ÿæ•ˆ
esp_err = mcpwm_init(MCPWM_UNIT_0, MCPWM_TIMER_0, &motor_pwm_config);
// è®¾ç½®å•å…ƒ-å®šæ—¶å™¨-é€šé“å ç©ºæ¯”
mcpwm_set_duty(MCPWM_UNIT_0, MCPWM_TIMER_0, MCPWM_OPR_A, 60);
mcpwm_set_duty(MCPWM_UNIT_0, MCPWM_TIMER_0, MCPWM_OPR_B, 0);
// å¼€å¯/å…³é—­å®šæ—¶å™¨
mcpwm_start(MCPWM_UNIT_0, MCPWM_TIMER_0);
mcpwm_stop(MCPWM_UNIT_0, MCPWM_TIMER_0);
```

### ç”µæœº

**ç”µæœºæ§åˆ¶**

<img src="C:\Users\liufangfei\AppData\Roaming\Typora\typora-user-images\image-20220813092816054.png" alt="image-20220813092816054" style="zoom:80%;" />

æ°¸ç£ä½“ç£åœº --- é€šç”µçº¿åœˆç£åœº â†’ äº§ç”Ÿä½œç”¨åŠ›

ç”µæµæ­£å…¥åå‡º/æ­£å‡ºåå…¥ â†’ ç”µæœºæ­£è½¬/åè½¬ â†’ å°è½¦å‰è¿›/åé€€

<img src="C:\Users\liufangfei\AppData\Roaming\Typora\typora-user-images\image-20220813092541171.png" alt="image-20220813092541171" style="zoom:80%;" />

æ¥çº¿ï¼šVCCã€GNDã€Aï¼ˆGPIO26ï¼‰ã€Bï¼ˆGPIO27ï¼‰ï¼ˆAã€Bæ§åˆ¶è½¬å‘ï¼‰ç”µæ± ä¸ºç”µæœºç›´æ¥ä¾›ç”µï¼ˆ7.4Vï¼‰

### èˆµæœºï¼ˆä¼ºæœç”µæœºï¼‰

**èˆµæœºæ§åˆ¶**

<img src="C:\Users\liufangfei\AppData\Roaming\Typora\typora-user-images\image-20220813092449574.png" alt="image-20220813092449574" style="zoom:67%;" />

GPIO13æ¥M996èˆµæœº --- æ§åˆ¶å°è½¦è½¬å‘

èˆµæœºéœ€ç”¨PWMä¿¡å·é©±åŠ¨ï¼Œé¢‘ç‡å›ºå®šä¸º50ï¼ˆ1s50ä¸ªå‘¨æœŸï¼Œæ¯å‘¨æœŸ20msï¼‰

å·¦å³æé™ï¼š

é«˜ç”µå¹³0.5msï¼Œä½ç”µå¹³19.5ms â†’ æœ€å·¦ä½ç½®

é«˜ç”µå¹³1.5msï¼Œä½ç”µå¹³18.5ms â†’ æœ€å³ä½ç½®

æ¯å‘¨æœŸé«˜ç”µå¹³å 0.5ms-2.5msï¼Œå¯¹åº”æ—‹è½¬è§’åº¦0Â°-180Â°

```C
// 1.èˆµæœºåˆå§‹åŒ–åˆ°90Â°ä½ç½®

// 2.èˆµæœºç¼“æ…¢ç”±0Â°è½¬è‡³180Â°
```

-------------

**å°è½¦ç»¼åˆåŠ¨ä½œå®éªŒ**

```C
const int servo=15;
const int motorA=26;
const int motorB=27;
//PWM
const int freq=50;
const int resolution=8;
const int servo_channel=0;
const int motorA_channel=1;
const int motorB_channel=2;

void setup() {
  //èˆµæœº
  ledcSetup(servo_channel,freq,resolution);
  ledcAttachPin(servo,servo_channel);
  //ç”µæœºA
  ledcSetup(motorA_channel,freq,resolution);
  ledcAttachPin(motorA,motorA_channel);
  //ç”µæœºB
  ledcSetup(motorB_channel,freq,resolution);
  ledcAttachPin(motorB,motorB_channel);
  //åˆå§‹åŒ–
  ledcWrite(servo_channel,20);
  ledcWrite(motorA_channel,0);
  ledcWrite(motorB_channel,0);
}

void loop() {
  while(1){
    ledcWrite(motorA_channel,128);
    delay(3000);
    ledcWrite(servo_channel,7);
    delay(1000);
    ledcWrite(motorA_channel,128);
    delay(3000);
    ledcWrite(servo_channel,20);
    delay(1000);
    ledcWrite(motorA_channel,128);
    delay(3000);
    ledcWrite(servo_channel,32);
    delay(1000);
    ledcWrite(motorA_channel,128);
    delay(3000);
    ledcWrite(servo_channel,20);
    delay(1000);
    }
}
```

### ç½‘ç»œæ‘„åƒå¤´

æ‘„åƒå¤´å®‰è£…ï¼š

https://www.bilibili.com/video/BV1PY4y1A77U/?spm_id_from=333.788&vd_source=4172983847c80a53fb2e62caed743dc8

WiFiè°ƒè¯•ï¼š

â‘  å°†ç½‘é¡µæ§åˆ¶LEDç¨‹åºçƒ§å…¥ä¸»æ¿ï¼ˆéœ€è¦å¼€å¯ESP32æ¨¡å—çš„WIFIçƒ­ç‚¹ä¾›æ‘„åƒå¤´è¿æ¥ï¼‰

â‘¡ å°†IP_Cameraç¨‹åºçƒ§å…¥æ‘„åƒå¤´ï¼ˆçƒ§å†™å‰æ‹”å‡ºæ‘„åƒå¤´SDå¡ï¼Œé˜²æ­¢ä¸²å£å ç”¨ï¼‰

ä¸Šç”µ ä¸»æ¿å¤ä½ æ‘„åƒå¤´å¤ä½ æŸ¥çœ‹æ‘„åƒå¤´ä¸²å£æ¶ˆæ¯

> MCUç«¯å¼€å¯å±€åŸŸç½‘çƒ­ç‚¹
>
> æ‘„åƒå¤´ã€ç”µè„‘è¿æ¥å±€åŸŸç½‘çƒ­ç‚¹
>
> ä½¿ç”¨ç”µè„‘è®¿é—®æ‘„åƒå¤´ç½‘é¡µï¼ˆæ‘„åƒå¤´å†…çƒ§å†™çš„ç¨‹åºç”Ÿæˆçš„ç½‘é¡µï¼‰ï¼ŒæŸ¥çœ‹å®æ—¶æ‘„åƒç»“æœ

### æµ‹é€Ÿé’ˆ

ä¸»æ¿æ¥æµ‹é€Ÿé’ˆï¼Œä½œç½‘å…³å¼€å¯WiFiï¼Œå¯åŠ¨WebServer

PCç«¯æ¥å…¥ä¸»æ¿å±€åŸŸç½‘ï¼Œå‘ä¸»æ¿å‘é€HTTPè¯·æ±‚ï¼ˆ.pyæ–‡ä»¶ï¼‰ï¼ŒæŸ¥çœ‹æµ‹é€Ÿé’ˆè¯»æ•°

### imu

ä¸»æ¿æ¥imuï¼Œä½œç½‘å…³å¼€å¯WiFiï¼Œå¯åŠ¨WebServer

PCç«¯æ¥å…¥ä¸»æ¿å±€åŸŸç½‘ï¼Œå‘ä¸»æ¿å‘é€HTTPè¯·æ±‚ï¼ˆ.pyæ–‡ä»¶ï¼‰ï¼ŒæŸ¥çœ‹imuè¯»æ•°

> é‡‡ç”¨ä¸²å£è°ƒè¯•
>
> å¤ä½åä¿æŒimuä½ç½®ä¸åŠ¨ï¼Œè¯·æ±‚ä¸€æ¬¡è¯»æ•°ï¼›ï¼ˆåˆå§‹ä½ç½®è§’åº¦ï¼‰
>
> è½¬åŠ¨ï¼Œå†ä¸€æ¬¡è¯·æ±‚è¯»æ•°ï¼ˆè½¬åŠ¨åè§’åº¦ï¼‰

> æŠ¥é”™ï¼šA fatal error occurred: Failed to connect to ESP32: Timed out waiting for packet header
>
> â‘  connectedæ—¶æŒ‰ä½bootè„š
>
> â‘¡ æ‹”æ‰å¤–æ¥æ¨¡å—çƒ§å½•åå†æ¥å…¥ï¼ˆå¤–æ¥æ¨¡å—å¯èƒ½å ç”¨ä¸²å£ï¼‰

## å°è½¦ç»¼åˆæ§åˆ¶-åœ°å›¾è¡Œè¿›æ‹æ‘„

### IP_Cameraç«¯

#### 1. å¤´æ–‡ä»¶ï¼šåº“å¼•å…¥

```C
// STEP1ï¼šå¤´æ–‡ä»¶ï¼šåº“å¼•å…¥

#include "WiFi.h"
#include "esp_camera.h"
#include "esp_timer.h"
#include "img_converters.h"
#include "Arduino.h"
#include "soc/soc.h"           // Disable brownout problems
#include "soc/rtc_cntl_reg.h"  // Disable brownout problems
#include "driver/rtc_io.h"
#include <ESPAsyncWebServer.h>
#include <StringArray.h>
#include "FS.h"                // SDå¡æ‰€ç”¨åº“
#include "SD_MMC.h"            // SDå¡æ‰€ç”¨åº“
#include "time.h"
#include <WiFiUdp.h>
#include "driver/timer.h"
```

#### 2. å¸¸é‡å®šä¹‰&é¢„è®¾ç½®

> **1 Camera&SD Card**
>
> æ‘„åƒå¤´å‚æ•°ï¼šå®šä¹‰ä¸€ä¸ªcamera_config_tç±»å‹çš„ç»“æ„ä½“å˜é‡ï¼Œç„¶åç»™ç»“æ„ä¸­çš„æˆå‘˜èµ‹å€¼ï¼ˆcodeä¸­ï¼šä½¿ç”¨é»˜è®¤é…ç½®ï¼Œå‘½åä¸ºconfigï¼‰
>
> åˆå§‹åŒ–å‚æ•°é…ç½®ï¼šè°ƒç”¨err = esp_camera_init(&camera_config);å‡½æ•°è¿›è¡Œåˆå§‹åŒ–ï¼ˆcodeä¸­ï¼šä½¿ç”¨é»˜è®¤configï¼Œæ— éœ€é…ç½®ï¼‰
>
> > https://blog.csdn.net/professionalmcu/article/details/121970340
>
> ```c
> camera_config_t camera_config = {
> 	// å‚æ•°ä¿¡æ¯
>     ...
> };
> // åˆå§‹åŒ–æ‘„åƒå¤´å‚æ•°
> esp_err_t err;
> err = esp_camera_init(&camera_config);
> // åˆå§‹åŒ–æ‘„åƒå¤´
> configInitCamera();
> ```
>
> SD/MMDï¼šå‡ä¸ºå­˜å‚¨å¡
>
> > SDã€MMDçš„åŒºåˆ«ï¼šhttps://zhidao.baidu.com/question/4875813.html
>
> ```C
> // åˆå§‹åŒ–SDå¡
> initMicroSDCard();
> // å®šä¹‰rootæ–‡ä»¶ï¼Œå†…å®¹ä¸ºSD_MMCå¡ä¸­å†…å®¹ï¼Œå¹¶ç”Ÿæˆæ–‡ä»¶åˆ—è¡¨
> File root;
> root = SD_MMC.open("/");
> listDirectory(SD_MMC);
> ```
>
> **2 AsyncWebServerï¼š**
>
> åœ¨ä¸»æ¿å’Œæ‘„åƒå¤´æ¨¡ç»„æ­å»ºWebServer â†’ å®ç°PC/æ‰‹æœºå¯ä»¥ä½¿ç”¨æµè§ˆå™¨ï¼ˆWeb-HTTPï¼‰è®¿é—®ä¸»æ¿å¹¶å‘èµ·è¯·æ±‚ï¼Œä¸»æ¿é€šè¿‡HTTPå‘æ‘„åƒå¤´å‘èµ·è¯·æ±‚ï¼ŒWebServeré€šè¿‡å“åº”å‡½æ•°å¯¹è¯·æ±‚ä½œå‡ºå“åº”ï¼Œå®ŒæˆåŠŸèƒ½
>
> > Arduino for ESP32 ä¸­é»˜è®¤å°±æœ‰WebServerï¼Œä½†å†…ç½®WebServeréƒ½æ˜¯åŒæ­¥çš„ï¼Œä¸æ”¯æŒåŒæ—¶å¤„ç†å¤šä¸ªè¿æ¥
> >
> > AsyncWebServerä¸ºå¼‚æ­¥WebServerï¼Œå¯ä»¥å¤„ç†é¡µé¢çš„å¤šä¸ªè¿æ¥å’Œå¤šä¸ªç”¨æˆ·çš„è¯·æ±‚
>
> > https://blog.csdn.net/Naisu_kun/article/details/107019175
> >
> > https://blog.csdn.net/weixin_44107116/article/details/122522243
>
> ```C
> // 1.å£°æ˜WebServerå¯¹è±¡
> AsyncWebServer server(80);
> 
> // 2.å‘è¯·æ±‚ç«¯å“åº”
> request->send(200, "text/plain", "Hello World!");
> 
> // 3.å®šä¹‰å›è°ƒå‡½æ•°
> // å¯¹åº”æ ¹ç›®å½•"/";handleRootä¸ºå·²è‡ªå®šä¹‰å¥½çš„å‡½æ•°
> server.on("/", HTTP_GET, handleRoot);
> // å¯¹åº”æ ¹ç›®å½•,[]ä¸­ä¸ºrequestä¼ å…¥å‚æ•°ï¼Œ{}ä¸­ä¸ºå‡½æ•°ä½“å†…å®¹
> server.on("/", HTTP_GET, [](AsyncWebServerRequest * request) {
>     request->send_P(200, "text/html", list.c_str());
>   });
> 
> // 4.å¯åŠ¨æœåŠ¡å™¨
> server.begin(); 
> ```

```C
// STEP2ï¼šå¸¸é‡å®šä¹‰ï¼ˆWiFiè´¦å·å¯†ç ã€ç½‘å…³IPã€é™æ€IPã€å„å¼•è„šï¼‰

// 1.WiFié…ç½®
// ä¸»æ¿WiFiè´¦å·åŠå¯†ç 
const char* ssid = "luckin";
const char* password = "123456789";
// é™æ€IPï¼ˆç½‘ç»œæ‘„åƒå¤´ï¼‰
IPAddress local_IP(192, 168, 4, 5);
// ç½‘å…³IPï¼ˆä¸»æ¿ï¼‰
IPAddress gateway(192, 168, 4, 1);
// å­ç½‘æ©ç 
IPAddress subnet(255, 255, 0, 0);
// DNSï¼ˆå¯é€‰ï¼‰
IPAddress primaryDNS(8, 8, 8, 8);   
IPAddress secondaryDNS(8, 8, 4, 4); 

// 2.WebæœåŠ¡
// åœ¨80ç«¯å£åˆ›å»ºAsyncWebServeræœåŠ¡
AsyncWebServer server(80);
// ç›¸å…³å‚æ•°ï¼ˆå¯¹åº”ä¸åŒè¯·æ±‚æ›´æ”¹ä¸åŒå‚æ•°ï¼Œé©±åŠ¨ç¨‹åºè¿è¡Œï¼‰
boolean takeNewPhoto = false;
String lastPhoto = "";
String list = "";
hw_timer_t * timer = NULL;
hw_timer_t * timer_1 = NULL;
boolean isRecording = false;
// HTTP GETè¯·æ±‚å‚æ•°
const char* PARAM_INPUT_1 = "photo";
const char* PARAM_INPUT_2 = "record_time";
const char* PARAM_INPUT_3 = "record_interval";

// OV2640æ‘„åƒå¤´æ¨¡å—å¼•è„šå®šä¹‰ (CAMERA_MODEL_AI_THINKER)
#define PWDN_GPIO_NUM     32
#define RESET_GPIO_NUM    -1
#define XCLK_GPIO_NUM      0
#define SIOD_GPIO_NUM     26
#define SIOC_GPIO_NUM     27
#define Y9_GPIO_NUM       35
#define Y8_GPIO_NUM       34
#define Y7_GPIO_NUM       39
#define Y6_GPIO_NUM       36
#define Y5_GPIO_NUM       21
#define Y4_GPIO_NUM       19
#define Y3_GPIO_NUM       18
#define Y2_GPIO_NUM        5
#define VSYNC_GPIO_NUM    25
#define HREF_GPIO_NUM     23
#define PCLK_GPIO_NUM     22

// ä¿å­˜ç›¸æœºé…ç½®å‚æ•°
camera_config_t config;
// å®šä¹‰ç…§ç‰‡ä¿å­˜æ–‡ä»¶
File root;

// 3.å£°æ˜å¹¶å®šä¹‰å‡½æ•°ï¼ˆå†…å®¹ç•¥ï¼‰
void configInitCamera(){
    ...
  }

void initMicroSDCard(){
  ...
}

void takeSavePhoto(){
  ...
}

void take_save_record(long duration, long interval) {
  ...
}

void stop_record() {
  if (isRecording) {
   ...
}

void listDirectory(fs::FS &fs) {
  ...
}

void deleteFile(fs::FS &fs, const char * path){
  ...
}
```

#### 3.åˆå§‹åŒ–

> 1 æ–­ç”µæ¢æµ‹å™¨
>
> ESP32çš„ç”µå¹³ä½äºæŸä¸ªå€¼ï¼ˆè¯¥å€¼å¯ä»¥è®¾å®šï¼‰ï¼Œè§¦å‘äº†æ–­ç”µæ¢æµ‹å™¨ï¼Œæ–­ç”µæ¢æµ‹å™¨ä¼šä½¿å¾—ESP32é‡æ–°å¯åŠ¨
>
> > https://blog.csdn.net/qq_31232793/article/details/87889368
>
> 2 WiFi
>
> > æ–‡æ¡£ESP32 Learn with ArduinoåŠç¬”è®°ä¸­æœ‰è¯¦ç»†ä½¿ç”¨è¯´æ˜
>
> 3 æ‘„åƒå¤´&SDå¡åˆå§‹åŒ–
>
> è°ƒç”¨ov2640cameraåŠSDå¡å°è£…å¥½çš„å‡½æ•°åˆå§‹åŒ–ï¼Œå†…ç½®è¿”å›æˆåŠŸ/å¤±è´¥ä¿¡æ¯ï¼Œä½¿ç”¨ä¸²å£ç›‘è§†å™¨æŸ¥çœ‹/è°ƒè¯•
>
> 4 WebServer
>
> AsyncWebServerï¼ˆåœ¨å˜é‡å®šä¹‰éƒ¨åˆ†å·²ä»‹ç»ï¼‰

```C
void setup() {
  // 1. ç¦ç”¨æ–­ç”µæ¢æµ‹å™¨
  WRITE_PERI_REG(RTC_CNTL_BROWN_OUT_REG, 0);
  
  // æ‰“å¼€ä¸²å£ç”¨äºdebug
  Serial.begin(115200);

  // æ£€æŸ¥é™æ€IPé…ç½®
  if (!WiFi.config(local_IP, gateway, subnet, primaryDNS, secondaryDNS)) {
    Serial.println("STA Failed to configure");
  }
  // 2. WiFiè¿æ¥
  // ä½¿ç”¨è´¦å·å¯†ç æ¥å…¥WiFi
  WiFi.begin(ssid, password);
  // WiFiçŠ¶æ€ä¸ºæœªè¿æ¥æ—¶åœ¨ä¸²å£è¾“å‡ºâ€œ...â€
  while (WiFi.status() != WL_CONNECTED) {
    delay(1000);
    Serial.print(".");
  }
  // æˆåŠŸè¿æ¥æ—¶ä¸²å£è¾“å‡ºä¿¡æ¯
  Serial.println("");
  Serial.println("WiFi connected");
  Serial.print("Camera Stream Ready! Go to: http://");
  Serial.println(WiFi.localIP());
  
  // 3. æ‘„åƒå¤´åˆå§‹åŒ–
  // åˆå§‹åŒ–æ‘„åƒå¤´æ¨¡ç»„
  Serial.println("Initializing the camera module...");
  configInitCamera();
  // åˆå§‹åŒ–SDå¡
  Serial.println("Initializing the MicroSD card module... ");
  initMicroSDCard();
  
  // 4. WebServer
  // c_str()å°±æ˜¯å°†C++çš„stringè½¬åŒ–ä¸ºCçš„å­—ç¬¦ä¸²æ•°ç»„ï¼Œc_str()ç”Ÿæˆä¸€ä¸ªconst char *æŒ‡é’ˆï¼ŒæŒ‡å‘å­—ç¬¦ä¸²çš„é¦–åœ°å€
  server.on("/capture", HTTP_GET, [](AsyncWebServerRequest * request) {
    if (takeNewPhoto) {
      request->send_P(200, "text/plain", "");
    } else {
      camera_fb_t * frame = esp_camera_fb_get();
      request->send_P(200, "image/jpeg", (const uint8_t *)frame->buf, frame->len);
      esp_camera_fb_return(frame);
      frame = NULL;
    }
  });
  
  server.on("/list", HTTP_GET, [](AsyncWebServerRequest * request) {
    request->send_P(200, "text/html", list.c_str());
  });
  
  server.on("/view", HTTP_GET, [](AsyncWebServerRequest * request) {
    String inputMessage;
    String inputParam;
    // GET input1 value on <ESP_IP>/view?photo=<inputMessage>
    if (request->hasParam(PARAM_INPUT_1)) {
      inputMessage = "/" + request->getParam(PARAM_INPUT_1)->value();
      Serial.print("Trying to open ");
      Serial.println(inputMessage);
      inputParam = PARAM_INPUT_1;
    }
    else {
      inputMessage = "No message sent";
      inputParam = "none";
    }
    Serial.println(inputMessage);
    request->send(SD_MMC, inputMessage, "image/jpg", false);
  });
  
  // å½“ä¸»æ¿å‘æ‘„åƒå¤´æ¨¡ç»„åˆ é™¤ç…§ç‰‡çš„GETè¯·æ±‚ï¼Œè¦åˆ é™¤çš„å›¾ç‰‡åä»¥å‚æ•°å½¢å¼æ—©requestä¸­ä¼ å…¥
  // delete?photo=<inputMessage>
  server.on("/delete", HTTP_GET, [] (AsyncWebServerRequest *request) {
    String inputMessage;
    String inputParam;
    // è·å–ä¼ å…¥çš„å‚æ•°ä¿¡æ¯
    if (request->hasParam(PARAM_INPUT_1)) {
      inputMessage = "/" + request->getParam(PARAM_INPUT_1)->value();
      inputParam = PARAM_INPUT_1;
    }
    else {
      inputMessage = "No message sent";
      inputParam = "none";
    }
    Serial.println(inputMessage);
    // åˆ é™¤å¯¹åº”çš„æ–‡ä»¶
    deleteFile(SD_MMC, inputMessage.c_str());
    request->send(200, "text/html", "Done. Your photo named " + inputMessage + " was removed." +
                                     "<br><a href=\"/list\">view/delete other photos</a>.");
  });

  server.on("/record", HTTP_GET, [](AsyncWebServerRequest * request) {
    String inputMessage_2;
    String inputMessage_3;
    if (request->hasParam(PARAM_INPUT_2)) {
      inputMessage_2 = request->getParam(PARAM_INPUT_2)->value();
      if (request->hasParam(PARAM_INPUT_3)) {
        Serial.println("Start record... Can't get ip camera stream now.");
        inputMessage_3 = request->getParam(PARAM_INPUT_3)->value();
        take_save_record(inputMessage_2.toInt(), inputMessage_3.toInt());
      }
      else {
        inputMessage_3 = "Request on /record lacks Param 1!";
        Serial.println(inputMessage_3);
      }
    }
    else {
      inputMessage_2 = "Request on /record lacks Param 2!";
      Serial.println(inputMessage_2);
    }
  });
  
  server.on("/stop_record", HTTP_GET, [](AsyncWebServerRequest * request) {
    Serial.println("Stop record. You can get ip camera stream now.");
    stop_record();
  });
  
  // å¼€å¯WebServeræœåŠ¡
  server.begin();
  // å®šä¹‰SDå¡å­˜å‚¨æ–‡ä»¶å¤¹
  root = SD_MMC.open("/");
  listDirectory(SD_MMC);
}
```

#### 4.ä¸»å¾ªç¯

```c
void loop() {
  if (takeNewPhoto) {
    takeSavePhoto();
    takeNewPhoto = false;
  }
  delay(1);
}
```



### ESP32_MCUç«¯

#### 1.å¤´æ–‡ä»¶ï¼šåº“å¼•å…¥

```c
#include "WiFi.h"
#include "esp_timer.h"
#include "Arduino.h"
#include "soc/soc.h"           // Disable brownout problems
#include "soc/rtc_cntl_reg.h"  // Disable brownout problems
#include "driver/rtc_io.h"
#include "driver/mcpwm.h"
#include <ESPAsyncWebServer.h>
#include <StringArray.h>
#include <FS.h>
```

#### 2.å¸¸é‡å®šä¹‰&é¢„è®¾ç½®

> ç ç›˜æ˜¯æŒ‡æµ‹é‡è§’ä½ç§»çš„æ•°å­—ç¼–ç å™¨

```c
// 1. å¸¸é‡å®šä¹‰
// (1) å¼•è„š
// LEDå¼•è„š
const int front_led_pin = 32;
const int back_led_pin = 33;
const int left_turn_led_pin = 21;
const int right_turn_led_pin = 22;
const int brake_led_pin = 23;
// ç ç›˜å¼•è„š
const int encoder_pin = 2;
int count = 0;
float encoder_speed = 0.0;
int encoder_interval_ms = 500;
// ç”µæœºå¼•è„š
const int motor_pwm_pin_A = 27;
const int motor_pwm_pin_B = 26;
// servo pwm pin
const int servo_pwm_pin = 13;
// (2) å‚æ•°
// ç”µæœº/èˆµæœºå‚æ•°
int motor_duty_cycle = 30;
int servo_turn_angle = 45;
float servo_duty_cycle_center = 7.5;
float servo_duty_cycle_differ = 5;
// WiFiè´¦å·åŠå¯†ç 
const char* ssid = "luckin";
const char* password = "123456789";
// (3) HTMLç•Œé¢
const char index_html[] PROGMEM = R"rawliteral(
    // çœç•¥HTMLå†…å®¹
    ...
    )rawliteral";

// 2. é¢„å¤„ç†
// (1) å¼€å¯WebServeræœåŠ¡
AsyncWebServer server(80);
// (2) å£°æ˜å˜é‡
// ç»“æ„å˜é‡
esp_err_t esp_err;
// å£°æ˜å‡½æ•°ï¼ˆå‡½æ•°å†…å®¹ç•¥ï¼‰
void toggle_light(int color);
void control_all_light(bool);
void move_forward();
void move_backward();
void motor_stop();
void turn_left();
void turn_right();
void straight();
void IRAM_ATTR count_add() {
  count += 1;
}
```

#### 3.åˆå§‹åŒ–

```c
void setup() {
  // 1. å¯ç”¨ä¸²å£
  Serial.begin(115200);
  // 2. WiFiå¼€å¯
  WiFi.mode(WIFI_AP);
  if(!WiFi.softAPConfig(IPAddress(192, 168, 4, 1), IPAddress(192, 168, 4, 1), IPAddress(255, 255, 0, 0))){
      Serial.println("AP Config Failed");
  }
  WiFi.softAP(ssid, password, 1, 0, 10);

  IPAddress IP = WiFi.softAPIP();
  Serial.print("AP IP address: ");
  Serial.println(IP);

  // 3. å…³é—­æ–­ç”µæµ‹è¯•å™¨
  WRITE_PERI_REG(RTC_CNTL_BROWN_OUT_REG, 0);

  // 4. åˆå§‹åŒ–
  // LEDå¼•è„šåˆå§‹åŒ–
  pinMode(front_led_pin, OUTPUT);
  pinMode(back_led_pin, OUTPUT);
  pinMode(left_turn_led_pin, OUTPUT);
  pinMode(right_turn_led_pin, OUTPUT);
  pinMode(brake_led_pin, OUTPUT);

  // ç ç›˜å¼•è„šåˆå§‹åŒ–
  pinMode(encoder_pin, INPUT);
  attachInterrupt(encoder_pin, count_add, RISING);

  // PWMä¿¡å·åˆå§‹åŒ–
  // PWMä¿¡å·å‚æ•°
  mcpwm_gpio_init(MCPWM_UNIT_0, MCPWM0A, motor_pwm_pin_A);
  mcpwm_gpio_init(MCPWM_UNIT_0, MCPWM0B, motor_pwm_pin_B);
  mcpwm_config_t motor_pwm_config = {
    .frequency = 1000,
    .cmpr_a = 0,
    .cmpr_b = 0,
    .duty_mode = MCPWM_DUTY_MODE_0,
    .counter_mode = MCPWM_UP_COUNTER,
  };
  esp_err = mcpwm_init(MCPWM_UNIT_0, MCPWM_TIMER_0, &motor_pwm_config);
  if (esp_err == 0)
    Serial.println("Setting motor pwm success!");
  else {
    Serial.print("Setting motor pwm fail, error code: ");
    Serial.println(esp_err);
  }

  // èˆµæœºPWMé…ç½®
  mcpwm_gpio_init(MCPWM_UNIT_1, MCPWM1A, servo_pwm_pin);
  mcpwm_config_t servo_pwm_config;
  servo_pwm_config.frequency = 50;
  servo_pwm_config.cmpr_a = 0;
  servo_pwm_config.duty_mode = MCPWM_DUTY_MODE_0;
  servo_pwm_config.counter_mode = MCPWM_UP_COUNTER;
  esp_err = mcpwm_init(MCPWM_UNIT_1, MCPWM_TIMER_1, &servo_pwm_config);
  if (esp_err == 0)
    Serial.println("Setting servo pwm success!");
  else {
    Serial.print("Setting servo pwm fail, error code: ");
    Serial.println(esp_err);
  }
  mcpwm_start(MCPWM_UNIT_1, MCPWM_TIMER_1);

  // 5. WebServerå“åº”å‡½æ•°
  server.on("/", HTTP_GET, [](AsyncWebServerRequest * request) {
    request->send_P(200, "text/html", index_html);
  });
  // å…¶ä»–ç›®å½•èŠ‚ç‚¹çš„å“åº”å‡½æ•°ç•¥
  // WebServeræœåŠ¡å¼€å¯
  server.begin();
}
```

#### 4.ä¸»å¾ªç¯

```c
// ä¸»è¦ç”¨ä½œä¸²å£ç›‘è§†å’Œè°ƒè¯•
void loop() {
  count = 0;
  delay(encoder_interval_ms);
  encoder_speed = count / 18.0 / 21 * 6.2 * 3.14 * 1000 / encoder_interval_ms;
  Serial.print("Speed: ");
  Serial.println(encoder_speed);
}
```
